"use strict";const e=require("../common/vendor.js"),n=require("../config/domainEnv.js"),s=n=>{e.index.showToast({icon:"none",title:n})},t={200:"服务器成功返回请求的数据。",201:"新建或修改数据成功。",202:"一个请求已经进入后台排队（异步任务）。",204:"删除数据成功。",400:"请求错误。",401:"用户没有权限（用户名或密码错误）。",403:"拒绝访问。",404:"请求地址出错。",406:"请求的格式不可得。",408:"请求超时。",410:"请求的资源被永久删除，且不会再得到的。",422:"当创建一个对象时，发生一个验证错误。",500:"服务器内部错误。",502:"网关错误。",503:"服务不可用。",504:"网关超时。",505:"HTTP版本不受支持。"},o={request:o=>{let i=o.isLoading||!0;return i&&e.index.showLoading({title:o.loadingText||"加载中...",mask:!0}),Object.assign({},{"content-type":"application/json"},o.header),new Promise(((a,d)=>{e.index.request({url:n.domainEnv[n.domainEnv.env].api+o.url,data:o.data,method:o.method,header:o.header,success:e=>{const{data:n,statusCode:o}=e;200!==o&&(s(t[o]||n.message||"当前访问人数过多，请稍后再试"),d(t[o]||n.message||"当前访问人数过多，请稍后再试")),200!==n.code&&("string"==typeof n&&n.indexOf("Blocked by Sentinel")>-1&&d("Blocked by Sentinel"),s(n.message),d(n)),a(n)},fail:e=>{let n=e.message;e&&e.response&&(n=t[e.response.status]),s(n),d(n||new Error("当前访问人数过多，请稍后再试"))},complete:()=>{i&&e.index.hideLoading()}})}))}};exports.service=o;
